#cloud-config
# Cloud-init configuration for NVIDIA Air BCM deployment
# This configures passwords, SSH keys, and access for automation
#
# INSTRUCTIONS:
# 1. Copy this file to: cloud-init-password.yaml
# 2. Replace YOUR_SSH_PUBLIC_KEY_HERE with your actual SSH public key
#    (found in ~/.ssh/id_rsa.pub or ~/.ssh/id_ed25519.pub)
# 3. The {PASSWORD} placeholder will be replaced automatically by the script
#
# Example:
#   cp cloud-init-password.yaml.example cloud-init-password.yaml
#   # Then edit cloud-init-password.yaml and add your SSH key

# Change passwords for existing users
chpasswd:
  list: |
    root:{PASSWORD}
    ubuntu:{PASSWORD}
  expire: False

# Allow password authentication for SSH (as fallback)
ssh_pwauth: True

# Add SSH key to default user (ubuntu)
# Replace the placeholder below with your actual SSH public key
ssh_authorized_keys:
  - YOUR_SSH_PUBLIC_KEY_HERE

# Enable root SSH login and add SSH key
runcmd:
  - mkdir -p /root/.ssh
  - chmod 700 /root/.ssh
  - echo "YOUR_SSH_PUBLIC_KEY_HERE" >> /root/.ssh/authorized_keys
  - chmod 600 /root/.ssh/authorized_keys
  - sed -i 's/^#*PermitRootLogin.*/PermitRootLogin yes/' /etc/ssh/sshd_config
  - systemctl restart sshd
  - echo "Cloud-init: root SSH enabled, password and SSH key configured"

